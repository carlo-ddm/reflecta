<section class="page">
  <header class="page__header">
    <div class="page__header-row">
      <h1 class="page__title">Entry</h1>
      <div class="page__actions">
        <button
          mat-button
          class="rf-button rf-button--ghost"
          type="button"
          (click)="openDeleteDialog()"
          [disabled]="isDeleting()"
        >
          {{ isDeleting() ? 'Elimino...' : 'Elimina entry' }}
        </button>
        <a mat-button class="rf-button rf-button--tonal" routerLink="/entries">
          Torna alla lista dei tuoi scritti
        </a>
      </div>
    </div>
    <p class="page__subtitle">Rilettura completa dello scritto, con analisi (se presente).</p>
  </header>

  <div class="page__body">
    <div class="entry-detail__layout">
      <mat-card class="entry-detail" aria-label="Testo completo">
        <mat-card-content>
          <div class="entry-detail__header">
            <div class="entry-detail__meta">
              <time class="entry-detail__date" [attr.datetime]="entry()?.createdAt">
                {{ entry()?.createdAt | date : 'longDate' }}
              </time>
              <span class="entry-detail__dot" aria-hidden="true"></span>
            </div>
            <app-badge [hasAnalysis]="hasAnalysis()" />
          </div>

          <div class="entry-detail__text">
            <p>
              {{ entry()?.content || entry()?.snippet }}
            </p>
          </div>
        </mat-card-content>
      </mat-card>

      @if (hasAnalysis()) {
      <mat-card class="entry-analysis" aria-label="Analisi">
        <mat-card-content>
          <header class="entry-analysis__header">
            <h2 class="entry-analysis__title">Analisi</h2>
            <p class="entry-analysis__subtitle">Valori calcolati al momento del salvataggio.</p>
          </header>

          <div class="analysis-profile" aria-label="Profilo di analisi">
            <div class="analysis-profile__grid" role="list">
              @for (metric of analysisMetrics(); track metric.key) {
              <div class="analysis-metric" role="listitem">
                <div class="analysis-metric__label">{{ metric.label }}</div>
                <div class="analysis-metric__value">
                  {{ metric.value === null ? '--' : metric.value }}
                </div>
                <div class="analysis-metric__bar" aria-hidden="true">
                  <span [style.--pct]="metric.pct === null ? '0%' : metric.pct + '%'"> </span>
                </div>
              </div>
              }
            </div>

            <div class="analysis-chart" aria-label="Grafico (placeholder)">
              <div class="analysis-chart__frame" aria-hidden="true">
                <div class="analysis-chart__ring"></div>
                <div class="analysis-chart__ring"></div>
                <div class="analysis-chart__ring"></div>
                <div class="analysis-chart__dot"></div>
              </div>
              <p class="analysis-chart__hint">Grafico minimale (placeholder)</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      } @else {

      <mat-card class="entry-analysis entry-analysis--empty" aria-label="Analisi non disponibile">
        <mat-card-content>
          <header class="entry-analysis__header">
            <h2 class="entry-analysis__title">Analisi</h2>
            <p class="entry-analysis__subtitle">Non presente per questa entry.</p>
          </header>
          <p class="entry-analysis__empty">
            Questa entry e stata salvata senza analisi. Puoi richiederla al momento della scrittura.
          </p>
        </mat-card-content>
      </mat-card>
      }
    </div>
  </div>
</section>
